<?xml version="1.0" encoding="US-ASCII" ?>
<!--
 $Id$

 Transforms a single XML file using XSLT to bootstrap the build process for a
 XINS project.
-->

<project name="xins-bootstrap-ant" default="make-build" basedir=".">

	<target name="make-build">
		<property name="project_home" location="${user.dir}" />

		<available file="${xins_home}/src/xslt/xins-project_to_ant-build.xslt"
		           property="ant.build.xslt.exists" />
		<fail message="Cannot find XINS at ${xins_home}, check your XINS_HOME environment variable." unless="ant.build.xslt.exists" />

		<available file="${project_home}/xins-project.xml"
		           property="xins-project.xml.exists" />
		<fail message="Cannot find input file xins-project.xml in the ${project_home} directory, change your current directory to the one containing the xins-project.xml file." unless="xins-project.xml.exists" />

		<mkdir dir="${project_home}/build" />

		<property file="${xins_home}/.version.properties" />
		<condition property="dot.version.minor" value="${version.minor}">
			<or>
				<equals arg1="${version.minor}" arg2="-alpha" />
				<equals arg1="${version.minor}" arg2="-beta" />
				<equals arg1="${version.minor}" arg2="-rc" />
				<equals arg1="${version.minor}" arg2="" />
			</or>
		</condition>
		<property name="dot.version.minor" value=".${version.minor}" />
		<property name="version" value="${version.major}.${version.middle}${dot.version.minor}${version.build}${version.suffix}" />
		<dependset>
			<srcfileset    file="${xins_home}/.version.properties"                 />
			<srcfileset    dir="${project_home}"    includes="**/api.xml"          />
			<srcfileset    dir="${project_home}"    includes="**/impl.xml"         />
			<srcfileset    dir="${project_home}"    includes="**/environments.xml" />
			<targetfileset file="${project_home}/build/build.xml" />
		</dependset>
		<xslt in="${project_home}/xins-project.xml"
		       out="${project_home}/build/build.xml"
		       style="${xins_home}/src/xslt/xins-project_to_ant-build.xslt">
			<xmlcatalog>
				<classpath>
					<pathelement path="${xins_home}/src/dtd"/>
				</classpath>
				<dtd publicId="-//XINS//DTD XINS Project 1.0//EN"
				     location="${xins_home}/src/dtd/xins-project_1_0.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.0//EN"
				     location="${xins_home}/src/dtd/api_1_0.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.0//EN"
				     location="${xins_home}/src/dtd/function_1_0.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.0//EN"
				     location="${xins_home}/src/dtd/type_1_0.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.0//EN"
				     location="${xins_home}/src/dtd/resultcode_1_0.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.0//EN"
				     location="${xins_home}/src/dtd/impl_1_0.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.0//EN"
				     location="${xins_home}/src/dtd/environments_1_0.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.0//EN"
				     location="${xins_home}/src/dtd/log_1_0.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 1.1//EN"
				     location="${xins_home}/src/dtd/xins-project_1_1.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.1//EN"
				     location="${xins_home}/src/dtd/api_1_1.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.1//EN"
				     location="${xins_home}/src/dtd/function_1_1.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.1//EN"
				     location="${xins_home}/src/dtd/type_1_1.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.1//EN"
				     location="${xins_home}/src/dtd/resultcode_1_1.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.1//EN"
				     location="${xins_home}/src/dtd/impl_1_1.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.1//EN"
				     location="${xins_home}/src/dtd/environments_1_1.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.1//EN"
				     location="${xins_home}/src/dtd/log_1_1.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 1.2//EN"
				     location="${xins_home}/src/dtd/xins-project_1_2.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.2//EN"
				     location="${xins_home}/src/dtd/api_1_2.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.2//EN"
				     location="${xins_home}/src/dtd/function_1_2.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.2//EN"
				     location="${xins_home}/src/dtd/type_1_2.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.2//EN"
				     location="${xins_home}/src/dtd/resultcode_1_2.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.2//EN"
				     location="${xins_home}/src/dtd/impl_1_2.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.2//EN"
				     location="${xins_home}/src/dtd/environments_1_2.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.2//EN"
				     location="${xins_home}/src/dtd/log_1_2.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 1.3//EN"
				     location="${xins_home}/src/dtd/xins-project_1_3.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.3//EN"
				     location="${xins_home}/src/dtd/api_1_3.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.3//EN"
				     location="${xins_home}/src/dtd/function_1_3.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.3//EN"
				     location="${xins_home}/src/dtd/type_1_3.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.3//EN"
				     location="${xins_home}/src/dtd/resultcode_1_3.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.3//EN"
				     location="${xins_home}/src/dtd/impl_1_3.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.3//EN"
				     location="${xins_home}/src/dtd/environments_1_3.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.3//EN"
				     location="${xins_home}/src/dtd/log_1_3.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 1.4//EN"
				     location="${xins_home}/src/dtd/xins-project_1_4.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.4//EN"
				     location="${xins_home}/src/dtd/api_1_4.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.4//EN"
				     location="${xins_home}/src/dtd/function_1_4.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.4//EN"
				     location="${xins_home}/src/dtd/type_1_4.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.4//EN"
				     location="${xins_home}/src/dtd/resultcode_1_4.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.4//EN"
				     location="${xins_home}/src/dtd/impl_1_4.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.4//EN"
				     location="${xins_home}/src/dtd/environments_1_4.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.4//EN"
				     location="${xins_home}/src/dtd/log_1_4.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 1.5//EN"
				     location="${xins_home}/src/dtd/xins-project_1_5.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 1.5//EN"
				     location="${xins_home}/src/dtd/api_1_5.dtd" />
				<dtd publicId="-//XINS//DTD Function 1.5//EN"
				     location="${xins_home}/src/dtd/function_1_5.dtd" />
				<dtd publicId="-//XINS//DTD Type 1.5//EN"
				     location="${xins_home}/src/dtd/type_1_5.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 1.5//EN"
				     location="${xins_home}/src/dtd/resultcode_1_5.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 1.5//EN"
				     location="${xins_home}/src/dtd/impl_1_5.dtd" />
				<dtd publicId="-//XINS//DTD Environments 1.5//EN"
				     location="${xins_home}/src/dtd/environments_1_5.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 1.5//EN"
				     location="${xins_home}/src/dtd/log_1_5.dtd" />

				<dtd publicId="-//XINS//DTD XINS Project 2.0//EN"
				     location="${xins_home}/src/dtd/xins-project_2_0.dtd" />
				<dtd publicId="-//XINS//DTD XINS API 2.0//EN"
				     location="${xins_home}/src/dtd/api_2_0.dtd" />
				<dtd publicId="-//XINS//DTD Function 2.0//EN"
				     location="${xins_home}/src/dtd/function_2_0.dtd" />
				<dtd publicId="-//XINS//DTD Type 2.0//EN"
				     location="${xins_home}/src/dtd/type_2_0.dtd" />
				<dtd publicId="-//XINS//DTD Result Code 2.0//EN"
				     location="${xins_home}/src/dtd/resultcode_2_0.dtd" />
				<dtd publicId="-//XINS//DTD Implementation 2.0//EN"
				     location="${xins_home}/src/dtd/impl_2_0.dtd" />
				<dtd publicId="-//XINS//DTD Environments 2.0//EN"
				     location="${xins_home}/src/dtd/environments_2_0.dtd" />
				<dtd publicId="-//XINS//DTD XINS Logdoc 2.0//EN"
				     location="${xins_home}/src/dtd/log_2_0.dtd" />
			</xmlcatalog>
			<param name="xins_home"    expression="${xins_home}"    />
			<param name="project_home" expression="${project_home}" />
			<param name="builddir"     expression="${project_home}/build" />
			<param name="xins_version" expression="${version}"     />
		</xslt>
	</target>
</project>
