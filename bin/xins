#!/bin/sh
#
# -*- mode: Fundamental; tab-width: 4; -*-
# ex:ts=4
#
# $Id$
#
# Bootstraps the XINS execution program, by means of an Ant build file,
# bootstrap.xml.
#

# Make sure XINS_HOME is set
if [ "${XINS_HOME}" = "" ]
then
	echo "`basename $0`: FATAL: XINS_HOME not set."
	exit 1
fi

# Recognize version option
if [ "$1" = "-version" ] || [ "$1" = "version" ]
then
	ant -q -f ${XINS_HOME}/build.xml version
	exit 0
fi

# Recognize clean option
#
# This fixes SF.net bug #1110726: Invalid generated build.xml cannot be
# removed with 'xins clean'
if [ "$1" = "clean" ] && [ -f build/build.xml ]
then
	rm build/build.xml
fi

# Split arguments that do start with a hyphen and those that do not
#
# This fixes SF.net bug 1187914: Cannot pass arguments with the XINS command
# on Unix
until [ -z "$1" ]
do
    word=$1
    firstChar=${word:0:1}

    # Option found
    if [ "${firstChar}" = "-" ]
    then
        if [ ! -z "${__OPTS__}" ]
        then
            word="${word} "
        fi
        __OPTS__="${__OPTS__}${word}"

    # Target argument found
    else
        if [ ! -z "${__ARGS__}" ]
        then
            word="${word} "
        fi
        __ARGS__="${__ARGS__}${word}"
    fi
    shift
done

__CMD__="ant -f ${XINS_HOME}/src/ant/bootstrap.xml"
__CMD__="${__CMD__} -Dxins_home=${XINS_HOME}"
__CMD__="${__CMD__} -Dpwd=`pwd`"
if [ ! -z ${__OPTS__} ]
then
    __CMD__="${__CMD__} ${__OPTS__}"
fi
if [ ! -z ${__ARGS__} ]
then
    __CMD__="${__CMD__} -Dargs=${__ARGS__}"
fi

# Pass control to Ant
if [ "${XINS_VERBOSE}" = "true" ]
then
    echo Executing:
    echo ${__CMD__}
fi
${__CMD__}
